<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>3ë‹¨ê³„: í•œâ†’ì˜ ë§í•˜ê¸° - TES Speaking</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
</head>

<body>
    <div class="app-container" style="padding-bottom: 100px;">
        <!-- Header -->
        <header class="app-header">
            <a href="learn-step2.html" class="back-btn">â†</a>
            <h1 class="header-title">í•œâ†’ì˜ ë§í•˜ê¸°</h1>
            <div class="header-action"></div>
        </header>

        <!-- Progress -->
        <div style="padding: 0 20px;">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 75%;"></div>
            </div>
            <div class="step-indicator">
                <span class="current">3ë‹¨ê³„</span> / 4ë‹¨ê³„
            </div>
        </div>

        <div class="page-content">
            <!-- Step Header -->
            <div class="step-header">
                <span class="step-badge"><i class="ti ti-message-circle"></i> í•œâ†’ì˜ ë§í•˜ê¸°</span>
                <h2 class="step-title">í•œêµ­ì–´ë¥¼ ì˜ì–´ë¡œ ë§í•´ë³´ì„¸ìš”</h2>
            </div>

            <!-- Korean Sentence Card -->
            <div class="sentence-card">
                <div class="sentence-kr" id="sentenceKr"
                    style="font-size: 1.5rem; font-weight: 600; color: var(--text-dark);">
                    ì•ˆë…•í•˜ì„¸ìš”
                </div>
                <div class="sentence-en hidden" id="sentenceEn"
                    style="font-size: 1.25rem; color: var(--primary); margin-top: 16px;">
                    Hello
                </div>
            </div>

            <!-- Show Answer Button -->
            <button class="btn btn-outline btn-block" id="showAnswerBtn" onclick="toggleAnswer()">
                <i class="ti ti-bulb"></i> ì •ë‹µ ë³´ê¸°
            </button>

            <!-- Self Evaluation -->
            <div class="hidden mt-3" id="evalSection">
                <p class="text-center text-gray mb-2">ì´ ë¬¸ì¥ì„ ì–¼ë§ˆë‚˜ ì˜ ë§í–ˆë‚˜ìš”?</p>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="evaluate('hard')"
                        style="flex: 1; background: #FECACA;">ì–´ë ¤ì›Œìš” ğŸ˜“</button>
                    <button class="btn btn-secondary" onclick="evaluate('ok')"
                        style="flex: 1; background: #FEF3C7;">ë³´í†µì´ì—ìš” ğŸ˜</button>
                    <button class="btn btn-secondary" onclick="evaluate('good')"
                        style="flex: 1; background: #BBF7D0;">ì˜í–ˆì–´ìš” ğŸ˜Š</button>
                </div>
            </div>

            <!-- Sentence Counter -->
            <p class="text-center mt-3" style="color: var(--primary); font-weight: 600;">
                <span id="currentIndex">1</span> / <span id="totalCount">5</span> ë¬¸ì¥
            </p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="prevSentence()">ì´ì „</button>
            <button class="btn btn-primary" onclick="nextSentence()" id="nextBtn">ë‹¤ìŒ</button>
        </div>
    </div>

    <script src="../js/supabase.js"></script>
    <script>
        let sentences = [];
        let currentIndex = 0;
        let answerVisible = false;
        let evaluations = [];

        document.addEventListener('DOMContentLoaded', () => {
            sentences = JSON.parse(sessionStorage.getItem('currentSentences')) || [];
            if (sentences.length === 0) {
                window.location.href = 'learn-step1.html';
                return;
            }

            document.getElementById('totalCount').textContent = sentences.length;
            updateSentence();
        });

        function updateSentence() {
            const s = sentences[currentIndex];
            document.getElementById('sentenceKr').textContent = s.kr;
            document.getElementById('sentenceEn').textContent = s.en;
            document.getElementById('currentIndex').textContent = currentIndex + 1;

            // Reset state
            answerVisible = false;
            document.getElementById('sentenceEn').classList.add('hidden');
            document.getElementById('showAnswerBtn').classList.remove('hidden');
            document.getElementById('showAnswerBtn').innerHTML = '<i class="ti ti-bulb"></i> ì •ë‹µ ë³´ê¸°';
            document.getElementById('evalSection').classList.add('hidden');

            // Update next button text
            const nextBtn = document.getElementById('nextBtn');
            if (currentIndex === sentences.length - 1) {
                nextBtn.textContent = 'ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’';
            } else {
                nextBtn.textContent = 'ë‹¤ìŒ';
            }
        }

        function toggleAnswer() {
            answerVisible = !answerVisible;
            document.getElementById('sentenceEn').classList.toggle('hidden', !answerVisible);
            document.getElementById('showAnswerBtn').innerHTML = answerVisible ? '<i class="ti ti-eye-off"></i> ì •ë‹µ ìˆ¨ê¸°ê¸°' : '<i class="ti ti-bulb"></i> ì •ë‹µ ë³´ê¸°';

            if (answerVisible) {
                document.getElementById('evalSection').classList.remove('hidden');
            }
        }

        function evaluate(level) {
            evaluations[currentIndex] = level;

            // Auto advance to next
            setTimeout(() => {
                nextSentence();
            }, 300);
        }

        function prevSentence() {
            if (currentIndex > 0) {
                currentIndex--;
                updateSentence();
            }
        }

        function nextSentence() {
            if (currentIndex < sentences.length - 1) {
                currentIndex++;
                updateSentence();
            } else {
                // Save evaluations and go to step 4
                sessionStorage.setItem('evaluations', JSON.stringify(evaluations));
                window.location.href = 'learn-step4.html';
            }
        }
    </script>
</body>

</html>